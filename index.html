
<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gerai Cik Ani - Pemanis Mulut Anda Sekeluarga</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>
  <!-- Babel for JSX transpilation -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .gradient-bg { background: linear-gradient(135deg, #f3e8ff 0%, #fce7f3 100%); }
    .menu-compact { padding: 1rem !important; }
    .menu-compact h2 { font-size: 1.125rem; margin-bottom: 0.75rem; }
    .menu-compact .category-header { padding: 0.5rem 0.75rem; }
    .menu-compact .category-header h3 { font-size: 0.95rem; }
    .menu-compact .category-items { padding: 0.5rem 0.75rem; }
    .menu-compact .category-items .menu-item { padding: 0.5rem; font-size: 0.95rem; }
    .menu-compact .menu-item .increase-btn,
    .menu-compact .menu-item .decrease-btn { width: 1.75rem; height: 1.75rem; font-size: 0.75rem; }
    .menu-compact .menu-item .quantity-display { width: 1.75rem; font-size: 0.875rem; }
    .menu-compact .menu-item .flex.items-center { column-gap: 0.5rem; }
    .animate-pulse {
      animation: pulse 1.6s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: .5;
      }
    }
    .quantity-pop {
        animation: pop 0.3s ease-out;
    }
    @keyframes pop {
        0% { transform: scale(1); color: inherit; }
        50% { transform: scale(1.4); color: #8B5CF6; } /* purple-500 */
        100% { transform: scale(1); color: inherit; }
    }
    /* Style for date input placeholder */
    input[type="date"]:required:invalid::-webkit-datetime-edit {
        color: transparent;
    }
    input[type="date"]:focus::-webkit-datetime-edit {
        color: black !important;
    }
  </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client"
  }
}
</script>
</head>
<body class="gradient-bg min-h-screen">
  <div id="root"></div>

  <script type="text/babel" data-type="module">
    import React, { useState, useCallback, useMemo, useRef, useEffect } from 'react';
    import ReactDOM from 'react-dom/client';

    // ============================================================================
    // TYPES
    // ============================================================================
    const Page = {
      Home: 'Home',
      Menu: 'Menu',
      Booking: 'Booking'
    };

    // ============================================================================
    // CONSTANTS
    // ============================================================================
    const WHATSAPP_NUMBER = "60165774575";

    const MENU_CATEGORIES = [
      {
        id: 'cendol',
        name: 'Kategori Cendol',
        emoji: 'ðŸ¥¥',
        gradient: 'from-purple-600 to-pink-500',
        items: [
          { name: 'Cendol Biasa', price: 3.00 },
          { name: 'Cendol Kacang', price: 3.50 },
          { name: 'Cendol Jagung', price: 3.50 },
          { name: 'Cendol Pulut', price: 3.50 },
          { name: 'Cendol Cincau', price: 3.50 },
          { name: 'Cendol Special++', price: 4.50 },
        ],
      },
      {
        id: 'abc',
        name: 'Kategori ABC',
        emoji: 'ðŸ§Š',
        gradient: 'from-blue-600 to-cyan-500',
        items: [
          { name: 'ABC Biasa', price: 4.50 },
          { name: 'ABC Ori Gula Melaka', price: 4.50 },
          { name: 'ABC + Cendol (2 dalam 1)', price: 6.00 },
        ],
      },
      {
        id: 'jagung',
        name: 'Kategori Ais Jagung',
        emoji: 'ðŸŒ½',
        gradient: 'from-yellow-500 to-orange-500',
        items: [
          { name: 'Ais Jagung Biasa', price: 5.00 },
          { name: 'Special + Jagung', price: 6.00 },
        ],
      },
      {
        id: 'jelly',
        name: 'Kategori Ais Jelly',
        emoji: 'ðŸŸ¢',
        gradient: 'from-green-500 to-teal-500',
        items: [
          { name: 'Ais Jelly Limau Asam Boy', price: 4.50 },
          { name: 'Ais Jelly Mix', price: 4.50 },
          { name: 'Ais Cikong', price: 4.50 },
        ],
      },
      {
        id: 'koko',
        name: 'Kategori Ais Koko & Kepal Coklat',
        emoji: 'ðŸ«',
        gradient: 'from-amber-600 to-yellow-600',
        items: [
          { name: 'Ais Koko Biasa', price: 4.50 },
          { name: 'Ais Koko Special (mix topping)', price: 6.00 },
          { name: 'Ais Kepal Coklat VIRAL', price: 4.50 },
          { name: 'Ais Kepal Coklat Special (mix topping)', price: 6.00 },
        ],
      },
      {
        id: 'ubi',
        name: 'Kategori Ubi Lambung',
        emoji: 'ðŸ ',
        gradient: 'from-fuchsia-600 to-rose-500',
        items: [
          { name: 'Ubi Lambung - Set 10 pcs', price: 5.00 },
          { name: 'Ubi Lambung - Set 20 pcs', price: 10.00 },
          { name: 'Ubi Lambung - Set 35 pcs', price: 15.00 },
          { name: 'Ubi Lambung - Add On Topping', price: 2.00 },
        ],
      },
    ];

    const DELIVERY_OPTIONS = [
        { location: "Taman Kota Masai 2", fee: 3 },
        { location: "Taman Kota Masai 1 (Ciku/Duku/Bacang/Durian)", fee: 4 },
        { location: "Jalan Canggung, Jalan Asli, Selasih 1â€“10", fee: 4 },
        { location: "Selasih 11 ke atas, Selayang, Senangin, Sagai, Siakap", fee: 5 },
        { location: "Nusa Damai", fee: 5 },
        { location: "Taman Scientex", fee: 5 },
        { location: "Cahaya Masai", fee: 5 },
        { location: "Taman Tanjung Puteri", fee: 5 },
        { location: "Taman Cendana", fee: 5 },
        { location: "Bandar Bestari Perdana (Exora/Manggis/Akasia)", fee: 5 },
        { location: "Meridien East (Kemboja/Lili/Jasmine)", fee: 6 },
        { location: "Taman Air Biru", fee: 7 },
        { location: "Kampung Cahaya Baru", fee: 7 },
        { location: "Bukit Dahlia", fee: 7 },
        { location: "Taman Mawar", fee: 7 },
        { location: "Masai", fee: 7 },
        { location: "Tanjung Langsat", fee: 7 },
        { location: "Kg Pasir Putih", fee: 7 },
        { location: "Layang Kasa", fee: 7 },
        { location: "Taman Rinting", fee: 8 },
        { location: "Seri Alam", fee: 8 },
        { location: "Kongkong", fee: 9 },
    ];
    
    const MAJLIS_CENDOL_ITEMS = [
      {
        name: 'Cendol Biasa',
        freebieNote: 'Untuk tempahan 300 set ke atas: PERCUMA pulut',
        tiers: [
          { minQty: 50, maxQty: 199, price: 2.50 },
          { minQty: 200, maxQty: Infinity, price: 2.00 },
        ],
      },
      {
        name: 'Cendol + Kacang',
        freebieNote: 'Untuk tempahan 300 set ke atas: PERCUMA pulut',
        tiers: [
          { minQty: 50, maxQty: 199, price: 3.00 },
          { minQty: 200, maxQty: Infinity, price: 2.50 },
        ],
      },
      {
        name: 'Cendol + Kacang + Jagung',
        freebieNote: 'Untuk tempahan 300 set ke atas: PERCUMA pulut',
        tiers: [
          { minQty: 50, maxQty: 199, price: 3.50 },
          { minQty: 200, maxQty: Infinity, price: 3.00 },
        ],
      },
    ];

    const MAJLIS_UBI_PACKAGES = [
        { name: 'Pakej A (Minimum)', description: '15 kg â€” Untuk 375 orang', price: 900.00 },
        { name: 'Pakej B', description: '20 kg â€” Untuk 500 orang', price: 1100.00 },
        { name: 'Pakej C', description: '30 kg â€” Untuk 750 orang', price: 1650.00 },
        { name: 'Pakej Mewah', description: '40 kg â€” Untuk 1,000 orang', price: 2400.00 },
    ];

    // ============================================================================
    // PDF SERVICE
    // ============================================================================
    const generatePdf = (orderItems, customerDetails, deliveryOption, totalAmount) => {
      // (Implementation remains unchanged)
      return new Promise((resolve, reject) => {
        try {
          const { jsPDF } = window.jspdf;
          if (!jsPDF) throw new Error('jsPDF library not found.');
          
          const doc = new jsPDF({ unit: 'pt', format: 'a4' });
          const pageW = doc.internal.pageSize.getWidth();
          const margin = 40;
          let y = 0;

          // Define Colors & Fonts
          const primaryColor = '#8B5CF6'; // purple-500
          const textColor = '#374151'; // gray-700
          const lightTextColor = '#6B7280'; // gray-500

          // --- 1. Header ---
          doc.setFont('helvetica', 'bold');
          doc.setTextColor(primaryColor);
          doc.setFontSize(28);
          doc.text('Gerai Cik Ani', margin, 60);

          doc.setFont('helvetica', 'normal');
          doc.setFontSize(10);
          doc.setTextColor(lightTextColor);
          doc.text('ABC & Ubi Lambung', margin, 78);
          
          doc.setFont('helvetica', 'bold');
          doc.setFontSize(16);
          doc.setTextColor(textColor);
          doc.text('INVOIS', pageW - margin, 60, { align: 'right' });

          y = 100;
          doc.setDrawColor('#E5E7EB'); // gray-200
          doc.setLineWidth(1.5);
          doc.line(margin, y, pageW - margin, y);
          y += 10;
          
          // --- 2. Invoice Details ---
          const now = new Date();
          const invoiceId = `GCA-${now.getFullYear()}${(now.getMonth() + 1).toString().padStart(2, '0')}${now.getDate().toString().padStart(2, '0')}-${now.getHours().toString().padStart(2, '0')}${now.getMinutes().toString().padStart(2, '0')}`;
          const issueDate = now.toLocaleDateString('ms-MY', { day: '2-digit', month: '2-digit', year: 'numeric' });
          
          let leftColY = y + 30;
          doc.setFont('helvetica', 'bold');
          doc.setFontSize(10);
          doc.setTextColor(lightTextColor);
          doc.text('KEPADA:', margin, leftColY);
          
          doc.setFont('helvetica', 'normal');
          doc.setFontSize(11);
          doc.setTextColor(textColor);
          doc.text(customerDetails.name, margin, leftColY + 15);
          doc.text(customerDetails.phone, margin, leftColY + 30);
          const addressLines = doc.splitTextToSize(customerDetails.address, (pageW / 2) - margin - 20);
          doc.text(addressLines, margin, leftColY + 45);
          const leftColEndY = leftColY + 45 + ((addressLines.length - 1) * 12 * 1.15);

          let rightColY = y + 30;
          const rightDetailsX = pageW - margin;
          doc.setFont('helvetica', 'bold');
          doc.setFontSize(10);
          doc.setTextColor(lightTextColor);
          doc.text('NO. INVOIS:', rightDetailsX - 100, rightColY, { align: 'left' });
          doc.setFont('helvetica', 'normal');
          doc.setFontSize(11);
          doc.setTextColor(textColor);
          doc.text(invoiceId, rightDetailsX, rightColY, { align: 'right' });
          
          rightColY += 20;
          doc.setFont('helvetica', 'bold');
          doc.setFontSize(10);
          doc.setTextColor(lightTextColor);
          doc.text('TARIKH:', rightDetailsX - 100, rightColY, { align: 'left' });
          doc.setFont('helvetica', 'normal');
          doc.setFontSize(11);
          doc.setTextColor(textColor);
          doc.text(issueDate, rightDetailsX, rightColY, { align: 'right' });
          const rightColEndY = rightColY;
          
          y = Math.max(leftColEndY, rightColEndY) + 40;

          // --- 3. Order Table ---
          const head = [['#', 'Perkara', 'Kuantiti', 'Harga Seunit', 'Jumlah']];
          let itemCounter = 1;
          const body = Object.entries(orderItems).map(([name, { quantity, price }]) => [
              (itemCounter++).toString(),
              name,
              quantity.toString(),
              `RM ${price.toFixed(2)}`,
              `RM ${(price * quantity).toFixed(2)}`,
          ]);
          
          if (doc.autoTable) {
            doc.autoTable({
                startY: y,
                head: head,
                body: body,
                theme: 'grid',
                headStyles: { 
                    fillColor: primaryColor,
                    textColor: '#FFFFFF',
                    fontStyle: 'bold'
                },
                styles: {
                    font: 'helvetica',
                    fontSize: 10,
                    cellPadding: 8,
                },
                columnStyles: {
                    0: { halign: 'center', cellWidth: 35 },
                    2: { halign: 'center' },
                    3: { halign: 'right' },
                    4: { halign: 'right' },
                },
            });
            y = doc.lastAutoTable.finalY;
          }

          // --- 4. Totals ---
          const totalsX = pageW - margin;
          const subTotal = Object.values(orderItems).reduce((acc, item) => acc + item.price * item.quantity, 0);
          let totalsY = y + 30;
          
          doc.setFontSize(11);
          doc.setFont('helvetica', 'normal');
          doc.setTextColor(textColor);
          doc.text('Jumlah Kecil:', totalsX - 120, totalsY, { align: 'right' });
          doc.text(`RM ${subTotal.toFixed(2)}`, totalsX, totalsY, { align: 'right' });
          totalsY += 20;
          
          doc.text('Caj Penghantaran:', totalsX - 120, totalsY, { align: 'right' });
          doc.text(`RM ${deliveryOption.fee.toFixed(2)}`, totalsX, totalsY, { align: 'right' });
          totalsY += 20;
          
          doc.setLineWidth(1);
          doc.setDrawColor(lightTextColor);
          doc.line(totalsX - 250, totalsY, totalsX, totalsY);
          totalsY += 5;
          
          doc.setFont('helvetica', 'bold');
          doc.setFontSize(14);
          doc.setTextColor(primaryColor);
          doc.text('JUMLAH:', totalsX - 120, totalsY + 15, { align: 'right' });
          doc.text(`RM ${totalAmount.toFixed(2)}`, totalsX, totalsY + 15, { align: 'right' });
          y = totalsY + 15;

          // --- 5. Footer ---
          const pageHeight = doc.internal.pageSize.getHeight();
          const footerStartY = pageHeight - 80;
          
          doc.setFont('helvetica', 'bold');
          doc.setFontSize(10);
          doc.setTextColor(textColor);
          doc.text('Maklumat Pembayaran:', margin, footerStartY);
          
          doc.setFont('helvetica', 'normal');
          doc.setFontSize(9);
          doc.setTextColor(lightTextColor);
          doc.text('Sila tunggu maklum balas dan kod QR daripada kami untuk pembayaran.', margin, footerStartY + 15);
          
          doc.setDrawColor('#E5E7EB'); // gray-200
          doc.line(margin, pageHeight - 40, pageW - margin, pageHeight - 40);
          
          doc.setFontSize(9);
          doc.setTextColor(lightTextColor);
          doc.text('Terima kasih atas tempahan anda!', pageW / 2, pageHeight - 25, { align: 'center' });
          
          // --- 6. Save ---
          const filename = `Invois_GeraiCikAni_${invoiceId}.pdf`;
          doc.save(filename);
          resolve();

        } catch (error) {
          console.error("Failed to generate PDF:", error);
          reject(error);
        }
      });
    };
    
    const generateMajlisPdf = (orderItems, customerDetails, totalAmount, deposit, eventDate) => {
      return new Promise((resolve, reject) => {
        try {
          const { jsPDF } = window.jspdf;
          if (!jsPDF) throw new Error('jsPDF library not found.');
          
          const doc = new jsPDF({ unit: 'pt', format: 'a4' });
          const pageW = doc.internal.pageSize.getWidth();
          const margin = 40;
          let y = 0;

          const primaryColor = '#8B5CF6'; // purple-500
          const textColor = '#374151'; // gray-700
          const lightTextColor = '#6B7280'; // gray-500

          doc.setFont('helvetica', 'bold');
          doc.setTextColor(primaryColor);
          doc.setFontSize(28);
          doc.text('Gerai Cik Ani', margin, 60);

          doc.setFont('helvetica', 'normal');
          doc.setFontSize(10);
          doc.setTextColor(lightTextColor);
          doc.text('Tempahan Majlis', margin, 78);
          
          doc.setFont('helvetica', 'bold');
          doc.setFontSize(16);
          doc.setTextColor(textColor);
          doc.text('SEBUT HARGA', pageW - margin, 60, { align: 'right' });

          y = 100;
          doc.setDrawColor('#E5E7EB');
          doc.setLineWidth(1.5);
          doc.line(margin, y, pageW - margin, y);
          y += 10;
          
          const now = new Date();
          const invoiceId = `GCA-M-${now.getFullYear()}${(now.getMonth() + 1).toString().padStart(2, '0')}${now.getDate().toString().padStart(2, '0')}-${now.getHours().toString().padStart(2, '0')}${now.getMinutes().toString().padStart(2, '0')}`;
          const issueDate = now.toLocaleDateString('ms-MY', { day: '2-digit', month: '2-digit', year: 'numeric' });
          
          let leftColY = y + 30;
          doc.setFont('helvetica', 'bold');
          doc.setFontSize(10);
          doc.setTextColor(lightTextColor);
          doc.text('KEPADA:', margin, leftColY);
          
          doc.setFont('helvetica', 'normal');
          doc.setFontSize(11);
          doc.setTextColor(textColor);
          doc.text(customerDetails.name, margin, leftColY + 15);
          doc.text(customerDetails.phone, margin, leftColY + 30);
          const addressLines = doc.splitTextToSize(`Alamat Majlis: ${customerDetails.address}`, (pageW / 2) - margin - 20);
          doc.text(addressLines, margin, leftColY + 45);
          const leftColEndY = leftColY + 45 + ((addressLines.length) * 12 * 1.15);

          let rightColY = y + 30;
          const rightDetailsX = pageW - margin;
          doc.setFont('helvetica', 'bold');
          doc.setFontSize(10);
          doc.setTextColor(lightTextColor);
          doc.text('NO. SEBUT HARGA:', rightDetailsX - 110, rightColY, { align: 'left' });
          doc.setFont('helvetica', 'normal');
          doc.setFontSize(11);
          doc.setTextColor(textColor);
          doc.text(invoiceId, rightDetailsX, rightColY, { align: 'right' });
          
          rightColY += 20;
          doc.setFont('helvetica', 'bold');
          doc.setFontSize(10);
          doc.setTextColor(lightTextColor);
          doc.text('TARIKH KELUAR:', rightDetailsX - 110, rightColY, { align: 'left' });
          doc.setFont('helvetica', 'normal');
          doc.setFontSize(11);
          doc.setTextColor(textColor);
          doc.text(issueDate, rightDetailsX, rightColY, { align: 'right' });
          
          rightColY += 20;
          doc.setFont('helvetica', 'bold');
          doc.setFontSize(10);
          doc.setTextColor(lightTextColor);
          doc.text('TARIKH MAJLIS:', rightDetailsX - 110, rightColY, { align: 'left' });
          doc.setFont('helvetica', 'normal');
          doc.setFontSize(11);
          doc.setTextColor(textColor);
          doc.text(eventDate ? new Date(eventDate).toLocaleDateString('ms-MY', { day: '2-digit', month: '2-digit', year: 'numeric' }) : 'N/A', rightDetailsX, rightColY, { align: 'right' });
          const rightColEndY = rightColY;
          
          y = Math.max(leftColEndY, rightColEndY) + 40;

          const head = [['#', 'Perkara', 'Kuantiti (set)', 'Harga Seunit', 'Jumlah']];
          let itemCounter = 1;
          const body = Object.entries(orderItems).map(([name, { quantity, price }]) => [
              (itemCounter++).toString(),
              name,
              quantity.toString(),
              `RM ${price.toFixed(2)}`,
              `RM ${(price * quantity).toFixed(2)}`,
          ]);
          
          doc.autoTable({
              startY: y, head, body, theme: 'grid',
              headStyles: { fillColor: primaryColor, textColor: '#FFFFFF', fontStyle: 'bold' },
              styles: { font: 'helvetica', fontSize: 10, cellPadding: 8 },
              columnStyles: {
                  0: { halign: 'center', cellWidth: 35 },
                  2: { halign: 'center' },
                  3: { halign: 'right' },
                  4: { halign: 'right' },
              },
          });
          y = doc.lastAutoTable.finalY;

          const totalsX = pageW - margin;
          let totalsY = y + 30;
          
          doc.setFontSize(11);
          doc.setFont('helvetica', 'normal');
          doc.setTextColor(textColor);
          doc.text('Jumlah Penuh:', totalsX - 120, totalsY, { align: 'right' });
          doc.text(`RM ${totalAmount.toFixed(2)}`, totalsX, totalsY, { align: 'right' });
          totalsY += 20;
          
          const depositAmount = parseFloat(deposit) || 0;
          doc.text('Deposit:', totalsX - 120, totalsY, { align: 'right' });
          doc.text(`RM ${depositAmount.toFixed(2)}`, totalsX, totalsY, { align: 'right' });
          totalsY += 20;
          
          doc.setLineWidth(1);
          doc.setDrawColor(lightTextColor);
          doc.line(totalsX - 250, totalsY, totalsX, totalsY);
          totalsY += 5;
          
          doc.setFont('helvetica', 'bold');
          doc.setFontSize(14);
          doc.setTextColor(primaryColor);
          doc.text('BAKI BAYARAN:', totalsX - 120, totalsY + 15, { align: 'right' });
          doc.text(`RM ${(totalAmount - depositAmount).toFixed(2)}`, totalsX, totalsY + 15, { align: 'right' });

          const pageHeight = doc.internal.pageSize.getHeight();
          const footerStartY = pageHeight - 80;
          
          doc.setFont('helvetica', 'bold');
          doc.setFontSize(10);
          doc.setTextColor(textColor);
          doc.text('Maklumat Lanjut:', margin, footerStartY);
          
          doc.setFont('helvetica', 'normal');
          doc.setFontSize(9);
          doc.setTextColor(lightTextColor);
          doc.text('Sila hubungi kami untuk pengesahan tempahan dan pembayaran deposit.', margin, footerStartY + 15);
          
          doc.setDrawColor('#E5E7EB');
          doc.line(margin, pageHeight - 40, pageW - margin, pageHeight - 40);
          
          doc.setFontSize(9);
          doc.setTextColor(lightTextColor);
          doc.text('Terima kasih kerana memilih Gerai Cik Ani!', pageW / 2, pageHeight - 25, { align: 'center' });
          
          const filename = `SebutHarga_Majlis_GeraiCikAni_${invoiceId}.pdf`;
          doc.save(filename);
          resolve();

        } catch (error) {
          console.error("Failed to generate Majlis PDF:", error);
          reject(error);
        }
      });
    };

    // ============================================================================
    // COMPONENTS
    // ============================================================================

    const NotesModal = ({ isOpen, onClose }) => {
      if (!isOpen) return null;
      return (
        <div id="notesModal" className="fixed inset-0 z-50 flex items-center justify-center">
          <div id="notesOverlay" className="absolute inset-0 bg-black/50" onClick={() => onClose(false)}></div>
          <div className="relative z-10 max-w-md w-full mx-4 bg-white rounded-xl shadow-2xl overflow-hidden">
            <div className="p-6">
              <h3 className="text-xl font-bold text-purple-800 mb-3">ðŸ“Œ Nota Penting</h3>
              <ol className="list-decimal pl-5 space-y-2 text-gray-700 text-sm">
                <li>Rehat Solat Jumaat: 12.00 tengah hari â€“ 2.00 petang</li>
                <li>Caj tambahan mungkin dikenakan jika runner diminta singgah lebih dari 1 gerai (ikut budi bicara runner).</li>
                <li>Untuk kawasan Cahaya Baru, Tanjung Langsat, Kg Pasir Putih, mohon customer pin/share location siap-siap.</li>
              </ol>
              <button onClick={() => onClose(true)} className="mt-6 w-full bg-purple-600 text-white font-semibold py-3 rounded-lg hover:bg-purple-700 transition">
                Ye saya faham
              </button>
            </div>
          </div>
        </div>
      );
    };

    const Header = ({ currentPage, onNavigate }) => {
      const getButtonClass = (page) => {
        const baseClass = "text-purple-600 hover:text-purple-800 font-medium transition duration-300";
        const activeClass = "text-purple-800 font-bold";
        return currentPage === page ? `${baseClass} ${activeClass}` : baseClass;
      };
      return (
        <nav className="bg-white shadow-lg sticky top-0 z-50">
          <div className="max-w-6xl mx-auto px-4">
            <div className="flex justify-between items-center py-4">
              <div className="flex items-center space-x-2">
                <span className="text-xl font-bold text-purple-800">Gerai Cik Ani</span>
              </div>
              <div className="flex space-x-6">
                <button onClick={() => onNavigate(Page.Home)} className={getButtonClass(Page.Home)}>Utama</button>
                <button onClick={() => onNavigate(Page.Menu)} className={getButtonClass(Page.Menu)}>Menu</button>
                <button onClick={() => onNavigate(Page.Booking)} className={getButtonClass(Page.Booking)}>Tempahan</button>
              </div>
            </div>
          </div>
        </nav>
      );
    };

    const Footer = () => (
        <footer className="mt-16 pb-6">
          <div className="max-w-6xl mx-auto px-4">
            <div className="h-px bg-gradient-to-r from-transparent via-pink-400 to-transparent opacity-70 mb-6"></div>
            <div className="flex flex-col md:flex-row items-center justify-between gap-3 bg-purple-800 text-white rounded-xl px-5 py-4 shadow-lg">
              <div className="flex items-center gap-3">
                <div className="h-9 w-9 rounded-full bg-gradient-to-br from-purple-600 to-pink-500 flex items-center justify-center text-white">
                  <span className="text-sm font-bold">GA</span>
                </div>
                <div>
                  <p className="text-sm md:text-base font-semibold">Gerai Cik Ani</p>
                  <p className="text-xs text-purple-200">ABC & Ubi Lambung</p>
                </div>
              </div>
              <div className="text-xs md:text-sm text-purple-200">Â© 2024 Hak cipta terpelihara.</div>
            </div>
          </div>
        </footer>
    );

    const LocationIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clipRule="evenodd"/></svg>);
    const TimeIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.414-1.414L11 10.586V6z" clipRule="evenodd"/></svg>);
    const HomePage = ({ onNavigate }) => (
        <div id="homePage" className="container mx-auto px-4 py-8">
          <div className="flex flex-col items-center justify-center text-center py-8">
            <header className="mb-10">
              <h1 className="text-4xl sm:text-5xl md:text-6xl font-extrabold text-purple-800 drop-shadow-lg">Selamat Datang ke</h1>
              <h2 className="text-5xl sm:text-6xl md:text-8xl font-extrabold text-pink-600 drop-shadow-lg mt-2">Gerai Cik Ani</h2>
              <p className="text-xl text-gray-600 mt-4">ABC dan Ubi Lambung - Penyejuk hati di cuaca panas!</p>
            </header>
            <div className="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4 mb-12">
              <button onClick={() => onNavigate(Page.Menu)} className="bg-white border-2 border-pink-500 text-pink-500 font-bold py-3 px-8 rounded-full shadow-lg hover:bg-pink-50 transition duration-300 transform hover:scale-105 text-base">Lihat Menu</button>
              <button onClick={() => onNavigate(Page.Booking)} className="bg-purple-600 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:bg-purple-700 transition duration-300 transform hover:scale-105 text-base">Buat Tempahan</button>
            </div>
            <div className="w-full grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl">
              <div className="bg-white/90 backdrop-blur p-5 md:p-6 rounded-2xl shadow-lg border border-purple-100 flex items-center gap-4">
                <div className="shrink-0 w-12 h-12 rounded-full bg-gradient-to-br from-purple-600 to-pink-500 text-white flex items-center justify-center"><LocationIcon /></div>
                <div className="text-left">
                  <p className="text-xs uppercase tracking-widest text-purple-600 font-semibold mb-1">Alamat</p>
                  <p className="text-sm md:text-base font-semibold text-gray-800 leading-snug">NO18 TAPAK PENJAJA JALAN TEMBIKAI 7 TAMAN KOTA MASAI</p>
                  <p className="text-xs text-gray-500 mt-0.5">(DEPAN PASARAYAKU)</p>
                </div>
              </div>
              <div className="bg-white/90 backdrop-blur p-5 md:p-6 rounded-2xl shadow-lg border border-purple-100 flex items-center gap-4">
                <div className="shrink-0 w-12 h-12 rounded-full bg-gradient-to-br from-purple-600 to-pink-500 text-white flex items-center justify-center"><TimeIcon /></div>
                <div className="text-left">
                  <p className="text-xs uppercase tracking-widest text-purple-600 font-semibold mb-1">Waktu Operasi</p>
                  <p className="text-sm md:text-base text-gray-800 font-semibold">Isnin - Ahad</p>
                  <p className="text-xs text-gray-500">11:30 AM - 6:30 PM</p>
                </div>
              </div>
            </div>
          </div>
        </div>
    );

    const MenuCategoryCard = ({ category }) => (
      <div className="bg-white rounded-xl shadow-lg overflow-hidden">
        <div className={`bg-gradient-to-r ${category.gradient} text-white p-4`}>
          <h2 className="text-2xl font-bold flex items-center">{category.emoji} {category.name}</h2>
        </div>
        <div className="p-6">
          <div className="space-y-3">
            {category.items.map((item, index) => (
              <div key={item.name} className={`flex justify-between items-center py-2 ${index < category.items.length - 1 ? 'border-b border-gray-200' : ''}`}>
                <span className="font-medium text-gray-800">{item.name}</span>
                <span className="font-bold text-purple-600">RM {item.price.toFixed(2)}</span>
              </div>
            ))}
          </div>
        </div>
      </div>
    );
    const MenuPage = () => (
        <div id="menuPage" className="container mx-auto px-4 py-8">
          <div className="text-center mb-8">
            <h1 className="text-4xl md:text-5xl font-extrabold text-purple-800 mb-4">Menu</h1>
          </div>
          <div className="max-w-3xl mx-auto space-y-6">
            {MENU_CATEGORIES.map(category => (<MenuCategoryCard key={category.id} category={category} />))}
          </div>
        </div>
    );
    
    // --- BookingPage.tsx ---

    const PesananBiasaTab = () => {
        const [orderItems, setOrderItems] = useState({});
        const [deliveryOption, setDeliveryOption] = useState(null);
        const [customerDetails, setCustomerDetails] = useState({ name: '', phone: '', address: '', notes: '' });
        const [openCategory, setOpenCategory] = useState(null);
        const [isModalOpen, setIsModalOpen] = useState(false);
        const [pendingDelivery, setPendingDelivery] = useState(null);
        const [formErrors, setFormErrors] = useState([]);
        const [pdfStatus, setPdfStatus] = useState('idle');
        const [quantityKey, setQuantityKey] = useState(0);
        
        const deliverySectionRef = useRef(null);
        const deliveryHintShown = useRef(false);

        const subTotal = useMemo(() => Object.values(orderItems).reduce((acc, item) => acc + item.price * item.quantity, 0), [orderItems]);
        const totalAmount = useMemo(() => subTotal + (deliveryOption?.fee || 0), [subTotal, deliveryOption]);
        const isFormValid = useMemo(() => (
            Object.keys(orderItems).length > 0 &&
            !!deliveryOption &&
            customerDetails.name.trim() !== '' &&
            customerDetails.phone.trim() !== '' &&
            customerDetails.address.trim() !== ''
        ), [orderItems, deliveryOption, customerDetails]);

        useEffect(() => {
            const errors = [];
            if (Object.keys(orderItems).length === 0) errors.push('Item');
            if (!deliveryOption) errors.push('Harga penghantaran');
            if (customerDetails.name.trim() === '') errors.push('Nama');
            if (customerDetails.phone.trim() === '') errors.push('Telefon');
            if (customerDetails.address.trim() === '') errors.push('Alamat');
            setFormErrors(errors);

            if (!deliveryOption && Object.keys(orderItems).length > 0 && customerDetails.name && customerDetails.phone && customerDetails.address && !deliveryHintShown.current) {
                deliverySectionRef.current?.scrollIntoView({ behavior: 'smooth', block: 'center' });
                deliveryHintShown.current = true;
            }
        }, [customerDetails, orderItems, deliveryOption]);

        const handleQuantityChange = (item, change) => {
            setQuantityKey(prev => prev + 1);
            setOrderItems(prev => {
                const existingItem = prev[item.name];
                const newQuantity = (existingItem?.quantity || 0) + change;
                const newItems = { ...prev };
                if (newQuantity > 0) {
                    newItems[item.name] = { price: item.price, quantity: newQuantity };
                } else {
                    delete newItems[item.name];
                }
                return newItems;
            });
        };

        const handleDeliverySelect = (option) => {
            setPendingDelivery(option);
            setIsModalOpen(true);
        };

        const handleModalClose = (confirmed) => {
            setIsModalOpen(false);
            if (confirmed && pendingDelivery) {
                setDeliveryOption(pendingDelivery);
                deliveryHintShown.current = false;
            }
            setPendingDelivery(null);
        };
        
        const handleInputChange = (e) => {
            const { name, value } = e.target;
            setCustomerDetails(prev => ({ ...prev, [name]: value }));
        };

        const handleCombinedAction = async (e) => {
            e.preventDefault();
            if (!isFormValid) return;
        
            setPdfStatus('generating');
            try {
                await generatePdf(orderItems, customerDetails, deliveryOption, totalAmount);
                setPdfStatus('done');
                setTimeout(() => setPdfStatus('idle'), 4000);
            } catch (error) {
                setPdfStatus('error');
                return;
            }
        
            let itemCounter = 1;
            let orderList = Object.entries(orderItems)
                .map(([name, { quantity, price }]) => `${itemCounter++}. ${name} (x${quantity}) â€” RM ${(price * quantity).toFixed(2)}`)
                .join('\n');
            orderList += `\n\nCaj Penghantaran (${deliveryOption.location}): RM ${deliveryOption.fee.toFixed(2)}`;

            const orderDetails = `
TEMPAHAN BARU - GERAI CIK ANI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ABC CENDOL & UBI LAMBUNG BUS STAND TAMAN KOTA MASAI

*MAKLUMAT PELANGGAN:*
â€¢ Nama: ${customerDetails.name}
â€¢ Telefon: ${customerDetails.phone}
â€¢ Alamat: ${customerDetails.address}

*PESANAN:*
${orderList}
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
*JUMLAH TOTAL: RM ${totalAmount.toFixed(2)}*

*NOTA TAMBAHAN:*
${customerDetails.notes || 'Tiada'}

Terima kasih atas tempahan anda!
Sila tunggu maklum balas dan QR code daripada vendor.

SILA CALL YE JIKA KAMI LAMBAT BALAS CHAT ANDA, TERIMA KASIHâ€¦`.trim().replace(/\n/g, '%0A');

            window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${orderDetails}`, '_blank');
        };

        const OrderSummary = ({ orderItems, deliveryOption, totalAmount }) => (
          <div className="bg-white p-6 rounded-xl shadow-lg">
            <h2 className="text-2xl font-bold text-purple-800 mb-4">Ringkasan Pesanan</h2>
            <div id="orderSummary" className="mb-4 min-h-[6rem]">
              {Object.keys(orderItems).length === 0 && !deliveryOption ? (
                <p className="text-gray-500 text-center py-4">Belum ada item dipilih</p>
              ) : (
                <div>
                  {/* Items Section */}
                  {Object.keys(orderItems).length > 0 && (
                    <div className="space-y-2">
                      {Object.entries(orderItems).map(([name, { quantity, price }]) => (
                        <div key={name} className="flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0">
                          <div>
                            <span className="font-medium text-gray-800">{name}</span>
                            <span className="text-sm text-gray-500"> x{quantity}</span>
                          </div>
                          <span className="font-semibold text-gray-700">RM {(price * quantity).toFixed(2)}</span>
                        </div>
                      ))}
                    </div>
                  )}
                  {/* Delivery Section */}
                  {deliveryOption && (
                    <div className={`flex justify-between items-center pt-3 ${Object.keys(orderItems).length > 0 ? 'mt-3 border-t border-dashed border-gray-300' : ''}`}>
                      <div>
                        <span className="font-medium text-gray-800">Penghantaran</span>
                        <span className="text-xs text-gray-500 block">{deliveryOption.location}</span>
                      </div>
                      <span className="font-semibold text-gray-700">RM {deliveryOption.fee.toFixed(2)}</span>
                    </div>
                  )}
                </div>
              )}
            </div>
            {/* Total Section */}
            <div className="border-t-2 border-purple-200 pt-4">
              <div className="flex justify-between items-center">
                <span className="text-lg font-bold text-gray-800">Jumlah Total:</span>
                <span id="totalPrice" className="text-2xl font-extrabold text-purple-800">RM {totalAmount.toFixed(2)}</span>
              </div>
            </div>
          </div>
        );

        return (
            <>
                <div className="max-w-4xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div className="bg-white p-4 rounded-xl shadow-lg menu-compact">
                        <h2 className="text-xl font-bold text-purple-800 mb-3">Pilih Menu</h2>
                        <div className="space-y-3 max-h-[42rem] overflow-y-auto">
                           {MENU_CATEGORIES.map((cat) => (
                               <div key={cat.id}>
                                   <div className={`category-header bg-gradient-to-r ${cat.gradient} text-white p-2 rounded-t-lg cursor-pointer`} onClick={() => setOpenCategory(openCategory === cat.id ? null : cat.id)}>
                                       <h3 className="font-bold flex items-center justify-between">{cat.emoji} {cat.name} <span className="toggle-icon">{openCategory === cat.id ? 'â–¼' : 'â–¶'}</span></h3>
                                   </div>
                                   {openCategory === cat.id && (
                                       <div className="category-items space-y-2 p-2 border-l border-r border-b rounded-b-lg">
                                           {cat.items.map((item) => (
                                               <div key={item.name} className="menu-item flex justify-between items-center p-2 border rounded-lg hover:bg-purple-50 text-sm">
                                                   <div className="w-2/4"><span className="font-medium text-gray-800">{item.name}</span></div>
                                                   <div className="flex items-center gap-2">
                                                       <span className="text-purple-600 font-bold w-16 text-right">RM {item.price.toFixed(2)}</span>
                                                       <div className="flex items-center">
                                                           <button type="button" onClick={() => handleQuantityChange(item, -1)} className="decrease-btn bg-red-500 text-white w-7 h-7 rounded-full hover:bg-red-600 flex items-center justify-center">-</button>
                                                           <span key={quantityKey + item.name} className={`quantity-display w-8 text-center font-bold ${orderItems[item.name]?.quantity > 0 ? 'quantity-pop' : ''}`}>{orderItems[item.name]?.quantity || 0}</span>
                                                           <button type="button" onClick={() => handleQuantityChange(item, 1)} className="increase-btn bg-green-500 text-white w-7 h-7 rounded-full hover:bg-green-600 flex items-center justify-center">+</button>
                                                       </div>
                                                   </div>
                                               </div>
                                           ))}
                                       </div>
                                   )}
                               </div>
                           ))}
                        </div>
                    </div>
                    <div className="space-y-6">
                        <OrderSummary orderItems={orderItems} deliveryOption={deliveryOption} totalAmount={totalAmount} />
                        <div className="bg-white p-6 rounded-xl shadow-lg">
                            <h2 className="text-2xl font-bold text-purple-800 mb-4">Maklumat Anda</h2>
                            <form className="space-y-4" onSubmit={handleCombinedAction}>
                                <input type="text" name="name" placeholder="Nama Penuh *" value={customerDetails.name} onChange={handleInputChange} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" required />
                                <input type="tel" name="phone" placeholder="No. Telefon (WhatsApp) *" value={customerDetails.phone} onChange={handleInputChange} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" required />
                                <textarea name="address" placeholder="Alamat Penuh *" value={customerDetails.address} onChange={handleInputChange} rows="3" className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" required></textarea>
                                <textarea name="notes" placeholder="Nota Tambahan (cth: landmark, no rumah)" value={customerDetails.notes} onChange={handleInputChange} rows="2" className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500"></textarea>
                                <div ref={deliverySectionRef} className={`bg-purple-50 border-l-4 p-4 rounded-r-lg ${!deliveryOption && Object.keys(orderItems).length > 0 ? 'border-yellow-400 animate-pulse' : 'border-purple-200'}`}>
                                    <p className="font-semibold text-purple-800">Pilih Kawasan Penghantaran</p>
                                    <div className="max-h-40 overflow-y-auto mt-2 space-y-2 pr-2">
                                        {DELIVERY_OPTIONS.map((opt) => (
                                            <button key={opt.location} type="button" onClick={() => handleDeliverySelect(opt)} className={`w-full text-left p-2 rounded-lg text-sm transition ${deliveryOption?.location === opt.location ? 'bg-purple-600 text-white font-bold' : 'bg-white hover:bg-purple-100'}`}>
                                                {opt.location} <span className="font-semibold float-right">RM {opt.fee.toFixed(2)}</span>
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                
                                {isFormValid ? (
                                     <button type="submit" disabled={pdfStatus !== 'idle'} className="w-full bg-purple-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-purple-700 transition duration-300 transform hover:scale-105 flex items-center justify-center disabled:bg-gray-400 disabled:cursor-not-allowed">
                                        {pdfStatus === 'generating' && <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle><path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>}
                                        {pdfStatus === 'generating' ? 'Menjana Invois...' : (pdfStatus === 'done' ? 'Selesai! Sedia untuk Hantar' : 'Hantar Tempahan ke WhatsApp & Jana Invois')}
                                    </button>
                                ) : (
                                    <div className="w-full bg-gray-200 text-gray-500 text-sm p-3 rounded-lg text-center">
                                        Sila lengkapkan: <span className="font-semibold">{formErrors.join(', ')}</span>
                                    </div>
                                )}
                            </form>
                        </div>
                    </div>
                </div>
                <NotesModal isOpen={isModalOpen} onClose={handleModalClose} />
            </>
        );
    };

    const TempahanMajlisTab = () => {
        const [orderItems, setOrderItems] = useState({});
        const [customerDetails, setCustomerDetails] = useState({ name: '', phone: '', address: '', eventDate: '' });
        const [deposit, setDeposit] = useState('');
        const [pdfStatus, setPdfStatus] = useState('idle');

        const totalAmount = useMemo(() => {
          return Object.values(orderItems).reduce((sum, item) => sum + (item.price * item.quantity), 0);
        }, [orderItems]);

        const balance = useMemo(() => {
          return totalAmount - (parseFloat(deposit) || 0);
        }, [totalAmount, deposit]);

        const isFormValid = useMemo(() => (
            Object.keys(orderItems).length > 0 &&
            customerDetails.name.trim() !== '' &&
            customerDetails.phone.trim() !== '' &&
            customerDetails.address.trim() !== '' &&
            customerDetails.eventDate !== ''
        ), [orderItems, customerDetails]);

        const getPriceForQuantity = (item, quantity) => {
            if (quantity <= 0) return 0;
            const applicableTier = item.tiers.find(tier => quantity >= tier.minQty && quantity <= tier.maxQty);
            return applicableTier ? applicableTier.price : 0;
        };

        const handleQuantityChange = (item, newQuantityStr) => {
            const newQuantity = parseInt(newQuantityStr, 10);
            if (isNaN(newQuantity) || newQuantity < 0) {
                setOrderItems(prev => {
                    const newItems = { ...prev };
                    delete newItems[item.name];
                    return newItems;
                });
                return;
            };

            const price = getPriceForQuantity(item, newQuantity);
            
            setOrderItems(prev => {
                const newItems = { ...prev };
                if (newQuantity > 0 && price > 0) {
                    newItems[item.name] = { price, quantity: newQuantity };
                } else {
                    delete newItems[item.name];
                }
                return newItems;
            });
        };
        
        const handlePackageToggle = (pkg) => {
            setOrderItems(prev => {
                const newItems = {...prev};
                if (newItems[pkg.name]) {
                    delete newItems[pkg.name];
                } else {
                    newItems[pkg.name] = { price: pkg.price, quantity: 1 };
                }
                return newItems;
            });
        };

        const handleInputChange = (e) => {
            const { name, value } = e.target;
            setCustomerDetails(prev => ({ ...prev, [name]: value }));
        };

        const handleCombinedAction = async (e) => {
            e.preventDefault();
            if (!isFormValid) return;

            setPdfStatus('generating');
            try {
                await generateMajlisPdf(orderItems, customerDetails, totalAmount, deposit, customerDetails.eventDate);
                setPdfStatus('done');
                setTimeout(() => setPdfStatus('idle'), 4000);
            } catch (error) {
                setPdfStatus('error');
                return;
            }

            let itemCounter = 1;
            let orderList = Object.entries(orderItems)
                .map(([name, { quantity, price }]) => {
                    const ubiPkg = MAJLIS_UBI_PACKAGES.find(p => p.name === name);
                    if (ubiPkg) {
                        return `${itemCounter++}. ${name} (${ubiPkg.description}) â€” RM ${price.toFixed(2)}`;
                    }
                    return `${itemCounter++}. ${name} (x${quantity} set) @ RM ${price.toFixed(2)}/set â€” RM ${(price * quantity).toFixed(2)}`;
                })
                .join('\n');
            
            const freebieNotes = Object.entries(orderItems)
                .map(([name, { quantity }]) => {
                    const cendolItem = MAJLIS_CENDOL_ITEMS.find(i => i.name === name);
                    return (cendolItem && quantity >= 300) ? `â€¢ ${name}: PERCUMA Pulut` : null;
                })
                .filter(Boolean).join('\n');

            const orderDetails = `
TEMPAHAN MAJLIS - GERAI CIK ANI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

*MAKLUMAT PELANGGAN:*
â€¢ Nama: ${customerDetails.name}
â€¢ Telefon: ${customerDetails.phone}
â€¢ Alamat Majlis: ${customerDetails.address}
â€¢ Tarikh Majlis: ${new Date(customerDetails.eventDate).toLocaleDateString('ms-MY', { day: 'numeric', month: 'long', year: 'numeric' })}

*PESANAN:*
${orderList}

${freebieNotes ? `*PERCUMA:*\n${freebieNotes}\n` : ''}
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
*JUMLAH PENUH: RM ${totalAmount.toFixed(2)}*
${deposit ? `*DEPOSIT: RM ${parseFloat(deposit).toFixed(2)}*\n*BAKI BAYARAN: RM ${balance.toFixed(2)}*` : ''}

Terima kasih atas pertanyaan tempahan anda!
Sila tunggu maklum balas daripada kami untuk pengesahan.`.trim().replace(/\n/g, '%0A');

            window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${orderDetails}`, '_blank');
        };

        const OrderSummary = ({ orderItems, totalAmount, deposit, balance }) => (
          <div className="bg-white p-6 rounded-xl shadow-lg">
            <h2 className="text-2xl font-bold text-purple-800 mb-4">Ringkasan Tempahan</h2>
            <div className="mb-4 min-h-[6rem]">
              {Object.keys(orderItems).length === 0 ? (
                <p className="text-gray-500 text-center py-4">Pilih item untuk majlis anda</p>
              ) : (
                <div className="space-y-3">
                  {Object.entries(orderItems).map(([name, { quantity, price }]) => (
                    <div key={name} className="flex justify-between items-start pb-2 border-b border-gray-100 last:border-b-0">
                      <div>
                        <p className="font-medium text-gray-800">{name}</p>
                        <p className="text-xs text-gray-500">
                          { MAJLIS_UBI_PACKAGES.find(p=>p.name === name) 
                            ? MAJLIS_UBI_PACKAGES.find(p=>p.name === name)?.description
                            : `${quantity} set @ RM ${price.toFixed(2)}/set`
                          }
                        </p>
                      </div>
                      <span className="font-semibold text-gray-700">RM {(price * quantity).toFixed(2)}</span>
                    </div>
                  ))}
                </div>
              )}
            </div>
            {totalAmount > 0 && (
              <>
                <div className="py-3 space-y-2 text-sm">
                   <div className="flex justify-between items-center text-gray-600">
                        <span>Jumlah Penuh:</span>
                        <span className="font-semibold">RM {totalAmount.toFixed(2)}</span>
                   </div>
                   <div className="flex justify-between items-center text-gray-600">
                        <span>Deposit (jika ada):</span>
                        <span className="font-semibold">RM {(parseFloat(deposit) || 0).toFixed(2)}</span>
                   </div>
                </div>
                <div className="border-t-2 border-purple-200 mt-2 pt-3">
                  <div className="flex justify-between items-center">
                    <span className="text-lg font-bold text-gray-800">Baki Bayaran:</span>
                    <span className="text-2xl font-extrabold text-purple-800">RM {balance.toFixed(2)}</span>
                  </div>
                </div>
              </>
            )}
          </div>
        );

        return (
            <div className="max-w-4xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div className="space-y-6">
                    <div className="bg-white p-4 rounded-xl shadow-lg">
                         <h2 className="text-xl font-bold text-purple-800 mb-3">PILIHAN SET CENDOL:</h2>
                         <div className="space-y-4">
                            {MAJLIS_CENDOL_ITEMS.map((item) => (
                                <div key={item.name}>
                                    <label className="font-semibold text-gray-800">{item.name}</label>
                                    <input
                                        type="number"
                                        min="0"
                                        step="10"
                                        placeholder="Kuantiti (min 50)"
                                        className="w-full mt-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500"
                                        onChange={(e) => handleQuantityChange(item, e.target.value)}
                                        value={orderItems[item.name]?.quantity || ''}
                                    />
                                    <div className="text-xs text-gray-500 mt-1 space-x-2">
                                        {item.tiers.map(t => <span key={t.minQty}>{t.minQty}-{t.maxQty === Infinity ? 'ke atas' : t.maxQty}: RM{t.price.toFixed(2)}</span>)}
                                    </div>
                                    <p className="text-xs text-purple-600 font-medium mt-1">{item.freebieNote}</p>
                                </div>
                            ))}
                         </div>
                    </div>

                    <div className="bg-white p-4 rounded-xl shadow-lg">
                        <h2 className="text-xl font-bold text-purple-800 mb-2">PILIHAN UBI LAMBUNG</h2>
                        <p className="text-xs text-purple-700 font-semibold mb-3 bg-purple-100 p-2 rounded-md">âœ… SEMUA PAKEJ UBI LAMBUNG DISERTAKAN TOPPING COKLAT PERCUMA!</p>
                        <div className="space-y-2">
                            {MAJLIS_UBI_PACKAGES.map((pkg) => (
                                <button
                                    key={pkg.name}
                                    type="button"
                                    onClick={() => handlePackageToggle(pkg)}
                                    className={`w-full text-left p-3 rounded-lg border-2 transition ${orderItems[pkg.name] ? 'bg-purple-100 border-purple-600' : 'bg-white hover:bg-gray-50 border-gray-200'}`}
                                >
                                    <div className="flex justify-between items-center">
                                        <div>
                                            <p className={`font-bold ${orderItems[pkg.name] ? 'text-purple-800' : 'text-gray-800'}`}>{pkg.name}</p>
                                            <p className="text-xs text-gray-500">{pkg.description}</p>
                                        </div>
                                        <div className="text-right">
                                            <p className="font-bold text-purple-600">RM {pkg.price.toFixed(2)}</p>
                                        </div>
                                    </div>
                                </button>
                            ))}
                        </div>
                    </div>
                </div>

                <div className="space-y-6">
                    <OrderSummary orderItems={orderItems} totalAmount={totalAmount} deposit={deposit} balance={balance} />
                    <div className="bg-white p-6 rounded-xl shadow-lg">
                        <h2 className="text-2xl font-bold text-purple-800 mb-4">Maklumat Majlis</h2>
                        <form className="space-y-4" onSubmit={handleCombinedAction}>
                             <input type="text" name="name" placeholder="Nama Penuh *" value={customerDetails.name} onChange={handleInputChange} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" required />
                             <input type="tel" name="phone" placeholder="No. Telefon (WhatsApp) *" value={customerDetails.phone} onChange={handleInputChange} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" required />
                             <textarea name="address" placeholder="Alamat Penuh Majlis *" value={customerDetails.address} onChange={handleInputChange} rows="3" className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" required></textarea>
                             <div>
                                <label htmlFor="eventDate" className="block text-sm font-medium text-gray-700 mb-1">Tarikh Majlis *</label>
                                <input id="eventDate" type="date" name="eventDate" value={customerDetails.eventDate} onChange={handleInputChange} className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" required />
                             </div>
                             <div>
                                <label htmlFor="deposit" className="block text-sm font-medium text-gray-700 mb-1">Amaun Deposit (jika ada)</label>
                                <div className="relative">
                                  <span className="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">RM</span>
                                  <input id="deposit" type="number" placeholder="0.00" value={deposit} onChange={(e) => setDeposit(e.target.value)} className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500" />
                                </div>
                             </div>
                             {isFormValid ? (
                                <button type="submit" disabled={pdfStatus !== 'idle'} className="w-full bg-purple-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg hover:bg-purple-700 transition duration-300 transform hover:scale-105 flex items-center justify-center disabled:bg-gray-400 disabled:cursor-not-allowed">
                                    {pdfStatus === 'generating' && <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle><path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>}
                                    {pdfStatus === 'generating' ? 'Menjana Sebut Harga...' : (pdfStatus === 'done' ? 'Selesai! Sedia untuk Hantar' : 'Hantar Pertanyaan ke WhatsApp & Jana Sebut Harga')}
                                </button>
                            ) : (
                                <div className="w-full bg-gray-200 text-gray-500 text-sm p-3 rounded-lg text-center">
                                    Sila lengkapkan semua medan bertanda *
                                </div>
                            )}
                        </form>
                    </div>
                </div>
            </div>
        );
    };

    const BookingPage = () => {
        const [activeTab, setActiveTab] = useState('biasa');

        const TabButton = ({ isActive, onClick, children }) => (
            <button
              onClick={onClick}
              className={`w-full text-center py-3 font-bold rounded-t-lg transition ${
                isActive
                  ? 'bg-purple-600 text-white shadow-inner'
                  : 'bg-white text-purple-600 hover:bg-purple-50'
              }`}
            >
              {children}
            </button>
        );

        return (
            <div id="bookingPage" className="container mx-auto px-4 py-8">
                <div className="text-center mb-8">
                    <h1 className="text-4xl md:text-5xl font-extrabold text-purple-800 mb-2">Tempahan Online</h1>
                    <p className="text-gray-600">Pilih jenis tempahan anda di bawah.</p>
                </div>
                
                <div className="max-w-4xl mx-auto">
                    <div className="grid grid-cols-2">
                        <TabButton isActive={activeTab === 'biasa'} onClick={() => setActiveTab('biasa')}>
                            Pesanan Biasa (Delivery)
                        </TabButton>
                        <TabButton isActive={activeTab === 'majlis'} onClick={() => setActiveTab('majlis')}>
                            Tempahan Majlis
                        </TabButton>
                    </div>
                    
                    <div className="bg-transparent pt-8">
                      {activeTab === 'biasa' && <PesananBiasaTab />}
                      {activeTab === 'majlis' && <TempahanMajlisTab />}
                    </div>
                </div>
            </div>
        );
    };

    const App = () => {
      const [currentPage, setCurrentPage] = useState(Page.Home);
      const onNavigate = useCallback((page) => {
        window.scrollTo(0, 0);
        setCurrentPage(page);
      }, []);

      const renderPage = () => {
        switch (currentPage) {
          case Page.Menu:
            return <MenuPage />;
          case Page.Booking:
            return <BookingPage />;
          case Page.Home:
          default:
            return <HomePage onNavigate={onNavigate} />;
        }
      };

      return (
        <div className="flex flex-col min-h-screen">
            <Header currentPage={currentPage} onNavigate={onNavigate} />
            <main className="flex-grow">
                {renderPage()}
            </main>
            <Footer />
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
