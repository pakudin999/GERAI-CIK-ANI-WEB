
<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gerai Cik Ani - Pemanis Mulut Anda Sekeluarga</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>
  <!-- Babel for JSX transpilation -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .gradient-bg { background: linear-gradient(135deg, #f3e8ff 0%, #fce7f3 100%); }
    .menu-compact { padding: 1rem !important; }
    .menu-compact h2 { font-size: 1.125rem; margin-bottom: 0.75rem; }
    .menu-compact .category-header { padding: 0.5rem 0.75rem; }
    .menu-compact .category-header h3 { font-size: 0.95rem; }
    .menu-compact .category-items { padding: 0.5rem 0.75rem; }
    .menu-compact .category-items .menu-item { padding: 0.5rem; font-size: 0.95rem; }
    .menu-compact .menu-item .increase-btn,
    .menu-compact .menu-item .decrease-btn { width: 1.75rem; height: 1.75rem; font-size: 0.75rem; }
    .menu-compact .menu-item .quantity-display { width: 1.75rem; font-size: 0.875rem; }
    .menu-compact .menu-item .flex.items-center { column-gap: 0.5rem; }
    .animate-pulse {
      animation: pulse 1.6s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: .5;
      }
    }
  </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client"
  }
}
</script>
</head>
<body class="gradient-bg min-h-screen">
  <div id="root"></div>

  <script type="text/babel" data-type="module">
    import React, { useState, useCallback, useMemo, useRef, useEffect } from 'react';
    import ReactDOM from 'react-dom/client';

    // ============================================================================
    // TYPES
    // ============================================================================
    const Page = {
      Home: 'Home',
      Menu: 'Menu',
      Booking: 'Booking'
    };

    // ============================================================================
    // CONSTANTS
    // ============================================================================
    const WHATSAPP_NUMBER = "60165774575";

    const MENU_CATEGORIES = [
      {
        id: 'cendol',
        name: 'Kategori Cendol',
        emoji: '🥥',
        gradient: 'from-purple-600 to-pink-500',
        items: [
          { name: 'Cendol Biasa', price: 3.00 },
          { name: 'Cendol Kacang', price: 3.50 },
          { name: 'Cendol Jagung', price: 3.50 },
          { name: 'Cendol Pulut', price: 3.50 },
          { name: 'Cendol Cincau', price: 3.50 },
          { name: 'Cendol Special++', price: 4.50 },
        ],
      },
      {
        id: 'abc',
        name: 'Kategori ABC',
        emoji: '🧊',
        gradient: 'from-blue-600 to-cyan-500',
        items: [
          { name: 'ABC Biasa', price: 4.50 },
          { name: 'ABC Ori Gula Melaka', price: 4.50 },
          { name: 'ABC + Cendol (2 dalam 1)', price: 6.00 },
        ],
      },
      {
        id: 'jagung',
        name: 'Kategori Ais Jagung',
        emoji: '🌽',
        gradient: 'from-yellow-500 to-orange-500',
        items: [
          { name: 'Ais Jagung Biasa', price: 5.00 },
          { name: 'Special + Jagung', price: 6.00 },
        ],
      },
      {
        id: 'jelly',
        name: 'Kategori Ais Jelly',
        emoji: '🟢',
        gradient: 'from-green-500 to-teal-500',
        items: [
          { name: 'Ais Jelly Limau Asam Boy', price: 4.50 },
          { name: 'Ais Jelly Mix', price: 4.50 },
          { name: 'Ais Cikong', price: 4.50 },
        ],
      },
      {
        id: 'koko',
        name: 'Kategori Ais Koko & Kepal Coklat',
        emoji: '🍫',
        gradient: 'from-amber-600 to-yellow-600',
        items: [
          { name: 'Ais Koko Biasa', price: 4.50 },
          { name: 'Ais Koko Special (mix topping)', price: 6.00 },
          { name: 'Ais Kepal Coklat VIRAL', price: 4.50 },
          { name: 'Ais Kepal Coklat Special (mix topping)', price: 6.00 },
        ],
      },
      {
        id: 'ubi',
        name: 'Kategori Ubi Lambung',
        emoji: '🍠',
        gradient: 'from-fuchsia-600 to-rose-500',
        items: [
          { name: 'Ubi Lambung - Set 10 pcs', price: 5.00 },
          { name: 'Ubi Lambung - Set 20 pcs', price: 10.00 },
          { name: 'Ubi Lambung - Set 35 pcs', price: 15.00 },
          { name: 'Ubi Lambung - Add On Topping', price: 2.00 },
        ],
      },
    ];

    const DELIVERY_OPTIONS = [
        { location: "Taman Kota Masai 2", fee: 3 },
        { location: "Taman Kota Masai 1 (Ciku/Duku/Bacang/Durian)", fee: 4 },
        { location: "Jalan Canggung, Jalan Asli, Selasih 1–10", fee: 4 },
        { location: "Selasih 11 ke atas, Selayang, Senangin, Sagai, Siakap", fee: 5 },
        { location: "Nusa Damai", fee: 5 },
        { location: "Taman Scientex", fee: 5 },
        { location: "Cahaya Masai", fee: 5 },
        { location: "Taman Tanjung Puteri", fee: 5 },
        { location: "Taman Cendana", fee: 5 },
        { location: "Bandar Bestari Perdana (Exora/Manggis/Akasia)", fee: 5 },
        { location: "Meridien East (Kemboja/Lili/Jasmine)", fee: 6 },
        { location: "Taman Air Biru", fee: 7 },
        { location: "Kampung Cahaya Baru", fee: 7 },
        { location: "Bukit Dahlia", fee: 7 },
        { location: "Taman Mawar", fee: 7 },
        { location: "Masai", fee: 7 },
        { location: "Tanjung Langsat", fee: 7 },
        { location: "Kg Pasir Putih", fee: 7 },
        { location: "Layang Kasa", fee: 7 },
        { location: "Taman Rinting", fee: 8 },
        { location: "Seri Alam", fee: 8 },
        { location: "Kongkong", fee: 9 },
    ];

    // ============================================================================
    // PDF SERVICE
    // ============================================================================
    const generatePdf = (orderItems, customerDetails, deliveryOption, totalAmount) => {
      return new Promise((resolve, reject) => {
        try {
          const { jsPDF } = window.jspdf;
          if (!jsPDF) {
            throw new Error('jsPDF library not found.');
          }
          const doc = new jsPDF({ unit: 'pt', format: 'a4' });

          // Header
          doc.setFillColor(109, 40, 217); // purple-700
          doc.rect(0, 0, doc.internal.pageSize.getWidth(), 80, 'F');
          doc.setFont('helvetica', 'bold');
          doc.setTextColor(255, 255, 255);
          doc.setFontSize(18);
          doc.text('Gerai Cik Ani — Bil Tempahan', 40, 50);

          // Customer Details
          doc.setTextColor(0, 0, 0);
          doc.setFont('helvetica', 'normal');
          doc.setFontSize(11);
          let y = 120;
          doc.text(`Nama: ${customerDetails.name}`, 40, y);
          y += 20;
          doc.text(`Telefon: ${customerDetails.phone}`, 40, y);
          y += 20;
          
          const addressLines = doc.splitTextToSize(`Alamat: ${customerDetails.address}`, 515);
          doc.text(addressLines, 40, y);
          y += addressLines.length * 15;
          
          const deliveryLines = doc.splitTextToSize(`Penghantaran: ${deliveryOption.location}`, 515);
          doc.text(deliveryLines, 40, y);
          y += deliveryLines.length * 15;
          
          if (customerDetails.notes) {
            y += 10;
            const notesLines = doc.splitTextToSize(`Nota: ${customerDetails.notes}`, 515);
            doc.text(notesLines, 40, y);
            y += notesLines.length * 15;
          }

          // Order Table
          const head = [['Item', 'Kuantiti', 'Harga (RM)', 'Jumlah (RM)']];
          const body = Object.entries(orderItems).map(([name, { quantity, price }]) => [
            name,
            quantity.toString(),
            price.toFixed(2),
            (price * quantity).toFixed(2),
          ]);
          body.push([
            'Penghantaran',
            '1',
            deliveryOption.fee.toFixed(2),
            deliveryOption.fee.toFixed(2),
          ]);
          
          if (doc.autoTable) {
            doc.autoTable({
              startY: y + 20,
              head: head,
              body: body,
              theme: 'grid',
              headStyles: { fillColor: [109, 40, 217] },
              didDrawPage: (data) => {},
            });
            y = doc.lastAutoTable.finalY;
          } else {
            y += 30;
            doc.text('Item Dipesan:', 40, y);
            y += 15;
            body.forEach(row => {
                doc.text(`${row[0]} (x${row[1]}) - RM ${row[3]}`, 40, y);
                y += 15;
            });
          }

          // Total
          doc.setFontSize(14);
          doc.setFont('helvetica', 'bold');
          doc.text(`Jumlah Total: RM ${totalAmount.toFixed(2)}`, 40, y + 40);

          // Footer
          const pageHeight = doc.internal.pageSize.getHeight();
          doc.setFontSize(9);
          doc.setTextColor(100);
          doc.text('Terima kasih atas tempahan anda!', 40, pageHeight - 40);

          // Save
          const now = new Date();
          const filename = `Bil_GeraiCikAni_${now.toISOString().split('T')[0]}.pdf`;
          doc.save(filename);
          resolve();
        } catch (error) {
          console.error("Failed to generate PDF:", error);
          reject(error);
        }
      });
    };

    // ============================================================================
    // COMPONENTS
    // ============================================================================

    // --- NotesModal.tsx ---
    const NotesModal = ({ isOpen, onClose }) => {
      if (!isOpen) return null;

      return (
        <div id="notesModal" className="fixed inset-0 z-50 flex items-center justify-center">
          <div id="notesOverlay" className="absolute inset-0 bg-black/50" onClick={() => onClose(false)}></div>
          <div className="relative z-10 max-w-md w-full mx-4 bg-white rounded-xl shadow-2xl overflow-hidden">
            <div className="p-6">
              <h3 className="text-xl font-bold text-purple-800 mb-3">📌 Nota Penting</h3>
              <ol className="list-decimal pl-5 space-y-2 text-gray-700 text-sm">
                <li>Rehat Solat Jumaat: 12.00 tengah hari – 2.00 petang</li>
                <li>Caj tambahan mungkin dikenakan jika runner diminta singgah lebih dari 1 gerai (ikut budi bicara runner).</li>
                <li>Untuk kawasan Cahaya Baru, Tanjung Langsat, Kg Pasir Putih, mohon customer pin/share location siap-siap.</li>
              </ol>
              <button onClick={() => onClose(true)} className="mt-6 w-full bg-purple-600 text-white font-semibold py-3 rounded-lg hover:bg-purple-700 transition">
                Ye saya faham
              </button>
            </div>
          </div>
        </div>
      );
    };

    // --- Header.tsx ---
    const Header = ({ currentPage, onNavigate }) => {
      const getButtonClass = (page) => {
        const baseClass = "text-purple-600 hover:text-purple-800 font-medium transition duration-300";
        const activeClass = "text-purple-800 font-bold";
        return currentPage === page ? `${baseClass} ${activeClass}` : baseClass;
      };

      return (
        <nav className="bg-white shadow-lg sticky top-0 z-50">
          <div className="max-w-6xl mx-auto px-4">
            <div className="flex justify-between items-center py-4">
              <div className="flex items-center space-x-2">
                <span className="text-xl font-bold text-purple-800">Gerai Cik Ani</span>
              </div>
              <div className="flex space-x-6">
                <button onClick={() => onNavigate(Page.Home)} className={getButtonClass(Page.Home)}>Utama</button>
                <button onClick={() => onNavigate(Page.Menu)} className={getButtonClass(Page.Menu)}>Menu</button>
                <button onClick={() => onNavigate(Page.Booking)} className={getButtonClass(Page.Booking)}>Tempahan</button>
              </div>
            </div>
          </div>
        </nav>
      );
    };

    // --- Footer.tsx ---
    const Footer = () => {
      return (
        <footer className="mt-16 pb-6">
          <div className="max-w-6xl mx-auto px-4">
            <div className="h-px bg-gradient-to-r from-transparent via-pink-400 to-transparent opacity-70 mb-6"></div>
            <div className="flex flex-col md:flex-row items-center justify-between gap-3 bg-purple-800 text-white rounded-xl px-5 py-4 shadow-lg">
              <div className="flex items-center gap-3">
                <div className="h-9 w-9 rounded-full bg-gradient-to-br from-purple-600 to-pink-500 flex items-center justify-center text-white">
                  <span className="text-sm font-bold">GA</span>
                </div>
                <div>
                  <p className="text-sm md:text-base font-semibold">Gerai Cik Ani</p>
                  <p className="text-xs text-purple-200">ABC & Ubi Lambung</p>
                </div>
              </div>
              <div className="text-xs md:text-sm text-purple-200">© 2024 Hak cipta terpelihara.</div>
            </div>
          </div>
        </footer>
      );
    };

    // --- HomePage.tsx ---
    const LocationIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clipRule="evenodd"/></svg>);
    const TimeIcon = () => (<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.414-1.414L11 10.586V6z" clipRule="evenodd"/></svg>);
    const HomePage = ({ onNavigate }) => {
      return (
        <div id="homePage" className="container mx-auto px-4 py-8">
          <div className="flex flex-col items-center justify-center text-center py-8">
            <header className="mb-10">
              <h1 className="text-5xl md:text-6xl font-extrabold text-purple-800 drop-shadow-lg">Selamat Datang ke</h1>
              <h2 className="text-6xl md:text-8xl font-extrabold text-pink-600 drop-shadow-lg mt-2">Gerai Cik Ani</h2>
              <p className="text-xl text-gray-600 mt-4">ABC dan Ubi Lambung - Penyejuk hati di cuaca panas!</p>
            </header>
            <div className="flex flex-row space-x-4 mb-12">
              <button onClick={() => onNavigate(Page.Menu)} className="bg-pink-500 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:bg-pink-600 transition duration-300 transform hover:scale-105 text-lg">Lihat Menu</button>
              <button onClick={() => onNavigate(Page.Booking)} className="bg-purple-600 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:bg-purple-700 transition duration-300 transform hover:scale-105 text-lg">Buat Tempahan</button>
            </div>
            <div className="w-full grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl">
              <div className="bg-white/90 backdrop-blur p-5 md:p-6 rounded-2xl shadow-lg border border-purple-100 flex items-center gap-4">
                <div className="shrink-0 w-12 h-12 rounded-full bg-gradient-to-br from-purple-600 to-pink-500 text-white flex items-center justify-center"><LocationIcon /></div>
                <div className="text-left">
                  <p className="text-xs uppercase tracking-widest text-purple-600 font-semibold mb-1">Alamat</p>
                  <p className="text-sm md:text-base font-semibold text-gray-800 leading-snug">NO18 TAPAK PENJAJA JALAN TEMBIKAI 7 TAMAN KOTA MASAI</p>
                  <p className="text-xs text-gray-500 mt-0.5">(DEPAN PASARAYAKU)</p>
                </div>
              </div>
              <div className="bg-white/90 backdrop-blur p-5 md:p-6 rounded-2xl shadow-lg border border-purple-100 flex items-center gap-4">
                <div className="shrink-0 w-12 h-12 rounded-full bg-gradient-to-br from-purple-600 to-pink-500 text-white flex items-center justify-center"><TimeIcon /></div>
                <div className="text-left">
                  <p className="text-xs uppercase tracking-widest text-purple-600 font-semibold mb-1">Waktu Operasi</p>
                  <p className="text-sm md:text-base text-gray-800 font-semibold">Isnin - Ahad</p>
                  <p className="text-xs text-gray-500">11:30 AM - 6:30 PM</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    };

    // --- MenuPage.tsx ---
    const MenuCategoryCard = ({ category }) => (
      <div className="bg-white rounded-xl shadow-lg overflow-hidden">
        <div className={`bg-gradient-to-r ${category.gradient} text-white p-4`}>
          <h2 className="text-2xl font-bold flex items-center">{category.emoji} {category.name}</h2>
        </div>
        <div className="p-6">
          <div className="space-y-3">
            {category.items.map((item, index) => (
              <div key={item.name} className={`flex justify-between items-center py-2 ${index < category.items.length - 1 ? 'border-b border-gray-200' : ''}`}>
                <span className="font-medium text-gray-800">{item.name}</span>
                <span className="font-bold text-purple-600">RM {item.price.toFixed(2)}</span>
              </div>
            ))}
          </div>
        </div>
      </div>
    );
    const MenuPage = () => {
      return (
        <div id="menuPage" className="container mx-auto px-4 py-8">
          <div className="text-center mb-8">
            <h1 className="text-4xl md:text-5xl font-extrabold text-purple-800 mb-4">Menu</h1>
          </div>
          <div className="max-w-3xl mx-auto space-y-6">
            {MENU_CATEGORIES.map(category => (<MenuCategoryCard key={category.id} category={category} />))}
          </div>
        </div>
      );
    };

    // --- BookingPage.tsx ---
    const OrderSummary = ({ orderItems, deliveryOption, totalAmount }) => (
        <div className="bg-white p-6 rounded-xl shadow-lg">
          <h2 className="text-2xl font-bold text-purple-800 mb-4">Ringkasan Pesanan</h2>
          <div id="orderSummary" className="space-y-2 mb-4 min-h-[6rem]">
            {Object.keys(orderItems).length === 0 && !deliveryOption ? (
              <p className="text-gray-500 text-center py-4">Belum ada item dipilih</p>
            ) : (
              <>
                {Object.entries(orderItems).map(([name, { quantity, price }]) => {
                  const itemTotal = price * quantity;
                  return (
                    <div key={name} className="flex justify-between items-center py-2 border-b border-gray-100">
                      <div>
                        <span className="font-medium text-gray-800">{name}</span>
                        <span className="text-sm text-gray-500"> x{quantity}</span>
                      </div>
                      <span className="font-bold text-purple-600">RM {itemTotal.toFixed(2)}</span>
                    </div>
                  );
                })}
                {deliveryOption && (
                  <div className="flex justify-between items-center py-2 border-b border-gray-100">
                    <div>
                      <span className="font-medium text-gray-800">Penghantaran</span>
                      <span className="text-xs text-gray-500 block">{deliveryOption.location}</span>
                    </div>
                    <span className="font-bold text-purple-600">RM {deliveryOption.fee.toFixed(2)}</span>
                  </div>
                )}
              </>
            )}
          </div>
          <div className="border-t pt-4">
            <div className="flex justify-between items-center text-xl font-bold text-purple-800">
              <span>Jumlah Total:</span>
              <span id="totalPrice">RM {totalAmount.toFixed(2)}</span>
            </div>
          </div>
        </div>
    );
    const BookingPage = () => {
        const [orderItems, setOrderItems] = useState({});
        const [deliveryOption, setDeliveryOption] = useState(null);
        const [customerDetails, setCustomerDetails] = useState({ name: '', phone: '', address: '', notes: '' });
        const [openCategory, setOpenCategory] = useState(null);
        const [isModalOpen, setIsModalOpen] = useState(false);
        const [pendingDelivery, setPendingDelivery] = useState(null);
        const [formErrors, setFormErrors] = useState([]);
        const [pdfStatus, setPdfStatus] = useState('idle');

        const deliverySectionRef = useRef(null);
        const deliveryHintShown = useRef(false);

        const subTotal = useMemo(() => {
            return Object.values(orderItems).reduce((acc, item) => acc + item.price * item.quantity, 0);
        }, [orderItems]);

        const totalAmount = useMemo(() => {
            return subTotal + (deliveryOption?.fee || 0);
        }, [subTotal, deliveryOption]);

        const isFormValid = useMemo(() => {
            return (
                Object.keys(orderItems).length > 0 &&
                !!deliveryOption &&
                customerDetails.name.trim() !== '' &&
                customerDetails.phone.trim() !== '' &&
                customerDetails.address.trim() !== ''
            );
        }, [orderItems, deliveryOption, customerDetails]);

        useEffect(() => {
            const errors = [];
            if (customerDetails.name.trim() === '') errors.push('Nama');
            if (customerDetails.phone.trim() === '') errors.push('Telefon');
            if (customerDetails.address.trim() === '') errors.push('Alamat');
            if (Object.keys(orderItems).length === 0) errors.push('Item');
            if (!deliveryOption) errors.push('Harga penghantaran');

            setFormErrors(errors);

            if (
                !deliveryOption && 
                Object.keys(orderItems).length > 0 &&
                customerDetails.name && customerDetails.phone && customerDetails.address &&
                !deliveryHintShown.current
            ) {
                deliverySectionRef.current?.scrollIntoView({ behavior: 'smooth', block: 'center' });
                deliveryHintShown.current = true;
            }

        }, [customerDetails, orderItems, deliveryOption]);

        const handleQuantityChange = (item, change) => {
            setOrderItems(prev => {
                const existingItem = prev[item.name];
                const newQuantity = (existingItem?.quantity || 0) + change;
                const newItems = { ...prev };
                if (newQuantity > 0) {
                    newItems[item.name] = { price: item.price, quantity: newQuantity };
                } else {
                    delete newItems[item.name];
                }
                return newItems;
            });
        };

        const handleDeliverySelect = (option) => {
            setPendingDelivery(option);
            setIsModalOpen(true);
        };

        const handleModalClose = (confirmed) => {
            setIsModalOpen(false);
            if (confirmed && pendingDelivery) {
                setDeliveryOption(pendingDelivery);
                deliveryHintShown.current = false;
            }
            setPendingDelivery(null);
        };
        
        const handleInputChange = (e) => {
            const { name, value } = e.target;
            setCustomerDetails(prev => ({ ...prev, [name]: value }));
        };

        const handleSubmit = (e) => {
            e.preventDefault();
            if (!isFormValid) return;

            let orderList = Object.entries(orderItems)
                .map(([name, { quantity, price }]) => `- ${name} x${quantity} = RM ${(price * quantity).toFixed(2)}`)
                .join('\\n');

            if (deliveryOption) {
                orderList += `\\n- Penghantaran (${deliveryOption.location}) = RM ${deliveryOption.fee.toFixed(2)}`;
            }

            const orderDetails = `
TEMPAHAN BARU - GERAI CIK ANI
═══════════════════════════════════
ABC CENDOL & UBI LAMBUNG BUS STAND TAMAN KOTA MASAI

*MAKLUMAT PELANGGAN:*
• Nama: ${customerDetails.name}
• Telefon: ${customerDetails.phone}
• Alamat: ${customerDetails.address}

*PESANAN:*
${orderList}
═══════════════════════════════════
*JUMLAH TOTAL: RM ${totalAmount.toFixed(2)}*

*NOTA TAMBAHAN:*
${customerDetails.notes || 'Tiada'}

Terima kasih atas tempahan anda!
Sila tunggu maklum balas dan QR code daripada vendor.

SILA CALL YE JIKA KAMI LAMBAT BALAS CHAT ANDA, TERIMA KASIH…`.trim();

            const encodedMessage = encodeURIComponent(orderDetails);
            window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${encodedMessage}`, '_blank');
        };

        const handlePdfDownload = async () => {
            if (!isFormValid) return;
            setPdfStatus('generating');
            try {
                await generatePdf(orderItems, customerDetails, deliveryOption, totalAmount);
                setPdfStatus('done');
                setTimeout(() => setPdfStatus('idle'), 4000);
            } catch (error) {
                console.error("PDF generation failed:", error);
                setPdfStatus('error');
            }
        };
        
        return (
            <>
                <div className="container mx-auto px-4 py-8">
                    <div className="text-center mb-8">
                        <h1 className="text-4xl md:text-5xl font-extrabold text-purple-800 mb-4">Buat Tempahan</h1>
                        <p className="text-xl text-gray-600">Pilih item dan lihat jumlah harga secara automatik</p>
                    </div>
                    <div className="max-w-4xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div className="bg-white p-4 rounded-xl shadow-lg menu-compact">
                            <h2 className="text-xl font-bold text-purple-800 mb-3">Pilih Menu</h2>
                            <div className="space-y-3 max-h-[42rem] overflow-y-auto">
                               {MENU_CATEGORIES.map((cat) => (
                                   <div key={cat.id}>
                                       <div className={`category-header bg-gradient-to-r ${cat.gradient} text-white p-2 rounded-t-lg cursor-pointer`} onClick={() => setOpenCategory(openCategory === cat.id ? null : cat.id)}>
                                           <h3 className="font-bold flex items-center justify-between">{cat.emoji} {cat.name} <span className="toggle-icon">{openCategory === cat.id ? '▼' : '▶'}</span></h3>
                                       </div>
                                       {openCategory === cat.id && (
                                           <div className="category-items space-y-2 p-2 border-l border-r border-b rounded-b-lg">
                                               {cat.items.map((item) => (
                                                   <div key={item.name} className="menu-item flex justify-between items-center p-2 border rounded-lg hover:bg-purple-50 text-sm">
                                                       <div className="w-2/4"><span className="font-medium text-gray-800">{item.name}</span></div>
                                                       <div className="flex items-center gap-2">
                                                           <span className="text-purple-600 font-bold w-16 text-right">RM {item.price.toFixed(2)}</span>
                                                           <div className="flex items-center">
                                                               <button type="button" onClick={() => handleQuantityChange(item, -1)} className="decrease-btn bg-red-500 text-white w-7 h-7 rounded-full hover:bg-red-600 flex items-center justify-center">-</button>
                                                               <span className="quantity-display w-8 text-center font-bold">{orderItems[item.name]?.quantity || 0}</span>
                                                               <button type="button" onClick={() => handleQuantityChange(item, 1)} className="increase-btn bg-green-500 text-white w-7 h-7 rounded-full hover:bg-green-600 flex items-center justify-center">+</button>
                                                           </div>
                                                       </div>
                                                   </div>
                                               ))}
                                           </div>
                                       )}
                                   </div>
                               ))}
                            </div>
                        </div>
                        <div className="space-y-6">
                            <div id="deliverySection" ref={deliverySectionRef} className={`bg-white p-4 rounded-xl shadow-lg transition-all duration-300 ${!deliveryOption && deliveryHintShown.current ? 'ring-2 ring-rose-300 animate-pulse' : ''}`}>
                                <h2 className="text-lg font-bold text-purple-800">📦 Harga Penghantaran 🛵</h2>
                                <p className="text-xs text-gray-500 mb-2">Pilih sub lokasi untuk sahkan</p>
                                {deliveryOption ? (
                                    <div className="text-sm text-purple-700 font-semibold p-2 bg-purple-50 rounded-md">Dipilih: {deliveryOption.location} - RM{deliveryOption.fee.toFixed(2)}</div>
                                ) : (
                                    <ul className="space-y-1 max-h-64 overflow-y-auto pr-1 text-sm">
                                        {DELIVERY_OPTIONS.map(opt => (
                                            <li key={opt.location} onClick={() => handleDeliverySelect(opt)} className="delivery-item p-2 rounded-lg border hover:bg-purple-50 cursor-pointer flex items-center justify-between">
                                                <span>• {opt.location}</span>
                                                <span className="ml-3 inline-block px-2 py-0.5 rounded-full bg-pink-100 text-pink-700 font-semibold">RM{opt.fee}</span>
                                            </li>
                                        ))}
                                    </ul>
                                )}
                            </div>
                            <OrderSummary orderItems={orderItems} deliveryOption={deliveryOption} totalAmount={totalAmount} />
                            <div className="bg-white p-6 rounded-xl shadow-lg">
                                <h2 className="text-2xl font-bold text-purple-800 mb-4">Maklumat Pelanggan</h2>
                                <form id="bookingForm" className="space-y-4" onSubmit={handleSubmit} noValidate>
                                    <input type="text" id="name" name="name" required value={customerDetails.name} onChange={handleInputChange} className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="Nama Penuh *" />
                                    <input type="tel" id="phone" name="phone" required value={customerDetails.phone} onChange={handleInputChange} className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="Nombor Telefon *" />
                                    <textarea id="address" name="address" rows={3} required value={customerDetails.address} onChange={handleInputChange} className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="Alamat Penuh *"></textarea>
                                    <textarea id="notes" name="notes" rows={3} value={customerDetails.notes} onChange={handleInputChange} className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500" placeholder="Nota Tambahan (Pilihan)"></textarea>
                                    <div id="submitBtnWrapper" className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                        <button type="submit" disabled={!isFormValid} className={`w-full text-white font-bold py-4 px-8 rounded-lg shadow-lg transition duration-300 text-lg ${isFormValid ? 'bg-gradient-to-r from-pink-500 to-purple-600 hover:scale-105' : 'bg-gray-400 cursor-not-allowed'}`}>📱 Hantar via WhatsApp</button>
                                        <button type="button" disabled={!isFormValid || pdfStatus === 'generating'} onClick={handlePdfDownload} className={`w-full text-white font-bold py-4 px-8 rounded-lg shadow-lg transition duration-300 text-lg ${isFormValid ? 'bg-gradient-to-r from-pink-500 to-purple-600 hover:scale-105' : 'bg-gray-400 cursor-not-allowed'}`}>{pdfStatus === 'generating' ? 'Menjana PDF...' : '🧾 Muat Turun Bil (PDF)'}</button>
                                    </div>
                                    {!isFormValid && formErrors.length > 0 && (<div className="mt-3 p-3 rounded-lg border text-sm bg-red-50 border-red-200 text-red-700">Sila isi: {formErrors.join(', ')}</div>)}
                                    {pdfStatus === 'done' && <p className="text-xs text-gray-500 md:col-span-2">PDF dijana. Jika tidak dimuat turun, benarkan pop-up pada pelayar anda.</p>}
                                    {pdfStatus === 'error' && <p className="text-xs text-red-600 md:col-span-2">Maaf, gagal menjana PDF. Cuba lagi.</p>}
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <NotesModal isOpen={isModalOpen} onClose={handleModalClose} />
            </>
        );
    };

    // ============================================================================
    // APP
    // ============================================================================
    const App = () => {
      const [currentPage, setCurrentPage] = useState(Page.Home);
      const handleNavigate = useCallback((page) => {
        setCurrentPage(page);
        window.scrollTo(0, 0);
      }, []);

      const renderPage = () => {
        switch (currentPage) {
          case Page.Menu: return <MenuPage />;
          case Page.Booking: return <BookingPage />;
          case Page.Home: default: return <HomePage onNavigate={handleNavigate} />;
        }
      };

      return (
        <div className="flex flex-col min-h-screen">
          <Header currentPage={currentPage} onNavigate={handleNavigate} />
          <main className="flex-grow">{renderPage()}</main>
          <Footer />
        </div>
      );
    };

    // ============================================================================
    // RENDER
    // ============================================================================
    const rootElement = document.getElementById('root');
    const root = ReactDOM.createRoot(rootElement);
    root.render(
      <React.StrictMode>
        <App />
      </React.StrictMode>
    );
  </script>
</body>
</html>
